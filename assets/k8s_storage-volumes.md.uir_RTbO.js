import{_ as s,o as i,c as a,R as n}from"./chunks/framework.PTn1Zvbw.js";const F=JSON.parse('{"title":"Kubenetes-存储卷（Volumes）","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"k8s/storage-volumes.md","filePath":"k8s/storage-volumes.md"}'),t={name:"k8s/storage-volumes.md"},e=n(`<h1 id="kubenetes-存储卷-volumes" tabindex="-1">Kubenetes-存储卷（Volumes） <a class="header-anchor" href="#kubenetes-存储卷-volumes" aria-label="Permalink to &quot;Kubenetes-存储卷（Volumes）&quot;">​</a></h1><h2 id="卷常见类型" tabindex="-1">卷常见类型 <a class="header-anchor" href="#卷常见类型" aria-label="Permalink to &quot;卷常见类型&quot;">​</a></h2><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><a href="#configMap">configMap</a></td><td><code>configMap</code> 卷提供了向 Pod 注入配置数据的方法</td></tr><tr><td><a href="#local">local</a></td><td><code>local</code> 卷所代表的是某个被挂载的本地存储设备，例如磁盘、分区或者目录。</td></tr><tr><td><a href="#nfs">nfs</a></td><td><code>nfs</code> 卷能将 NFS (网络文件系统) 挂载到你的 Pod 中</td></tr><tr><td><a href="#persistentvolumeclaim">persistentVolumeClaim</a></td><td><code>persistentVolumeClaim</code> 卷用来将持久卷（<a href="#persistentvolume">PersistentVolume</a>）挂载到 Pod 中。</td></tr><tr><td><a href="#secret">secret</a></td><td><code>secret</code> 卷用来给 Pod 传递敏感信息，例如密码。</td></tr></tbody></table><h2 id="configmap" tabindex="-1">configMap <a class="header-anchor" href="#configmap" aria-label="Permalink to &quot;configMap&quot;">​</a></h2><p>ConfigMap 更新到新键映射到 Pod 的总延迟可能与 kubelet 同步周期（默认为1分钟）+ kubelet 中 ConfigMap 缓存的 TTL（默认为1分钟）一样长。 你可以通过更新 Pod 的一个注解来触发立即刷新</p><blockquote><p>说明： 使用 ConfigMap 作为 subPath 卷的容器将不会收到 ConfigMap 更新。</p></blockquote><h3 id="基于一个目录来创建-configmap" tabindex="-1">基于一个目录来创建 ConfigMap <a class="header-anchor" href="#基于一个目录来创建-configmap" aria-label="Permalink to &quot;基于一个目录来创建 ConfigMap&quot;">​</a></h3><p>创建本地目录</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure-pod-container/configmap/</span></span></code></pre></div><p>下载示例的配置并创建 ConfigMap</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将示例文件下载到 \`configure-pod-container/configmap/\` 目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://kubernetes.io/examples/configmap/game.properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    configure-pod-container/configmap/game.properties</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://kubernetes.io/examples/configmap/ui.properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    configure-pod-container/configmap/ui.properties</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建 ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --from-file=configure-pod-container/configmap/</span></span></code></pre></div><p>以上命令将 <code>configure-pod-container/configmap</code> 目录下的所有文件，也就是 game.properties 和 ui.properties 打包到 game-config ConfigMap 中。你可以使用下面的命令显示 ConfigMap 的详细信息：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmaps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config</span></span></code></pre></div><p>输出类似以下内容：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         game-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Labels:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Annotations:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">====</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">game.properties:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enemies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aliens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat.level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=noGoodRotten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UUDDLRLRBABAS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.allowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.lives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ui.properties:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">color.good</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=purple</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">color.bad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=yellow</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">allow.textmode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">how.nice.to.look</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=fairlyNice</span></span></code></pre></div><p><code>configure-pod-container/configmap/</code> 目录中的 <code>game.properties</code> 和 <code>ui.properties</code> 文件出现在 ConfigMap 的 <code>data</code> 部分。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmaps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span></code></pre></div><p>输出类似以下内容:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  creationTimestamp:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-02-18T18:52:05Z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resourceVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;516&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  uid:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b4952dc3-d670-11e5-8cd0-68f728db1985</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  game.properties:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    enemies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aliens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    enemies.cheat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    enemies.cheat.level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=noGoodRotten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    secret.code.passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UUDDLRLRBABAS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    secret.code.allowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    secret.code.lives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=30    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ui.properties:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    color.good</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=purple</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    color.bad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=yellow</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    allow.textmode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    how.nice.to.look</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=fairlyNice</span></span></code></pre></div><h3 id="基于文件创建-configmap" tabindex="-1">基于文件创建 ConfigMap <a class="header-anchor" href="#基于文件创建-configmap" aria-label="Permalink to &quot;基于文件创建 ConfigMap&quot;">​</a></h3><p>你可以使用 <code>kubectl create configmap</code> 基于单个文件或多个文件创建 ConfigMap。</p><p>例如：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --from-file=configure-pod-container/configmap/game.properties</span></span></code></pre></div><p>将产生以下 ConfigMap:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmaps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-2</span></span></code></pre></div><p>输出类似以下内容:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         game-config-2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Labels:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Annotations:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">====</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">game.properties:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enemies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aliens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat.level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=noGoodRotten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UUDDLRLRBABAS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.allowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.lives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=30</span></span></code></pre></div><p>你可以多次使用 <code>--from-file</code> 参数，从多个数据源创建 ConfigMap。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --from-file=configure-pod-container/configmap/game.properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --from-file=configure-pod-container/configmap/ui.properties</span></span></code></pre></div><p>你可以使用以下命令显示 <code>game-config-2</code> ConfigMap 的详细信息：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmaps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-2</span></span></code></pre></div><p>输出类似以下内容:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         game-config-2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Labels:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Annotations:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">====</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">game.properties:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enemies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aliens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enemies.cheat.level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=noGoodRotten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UUDDLRLRBABAS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.allowed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secret.code.lives</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ui.properties:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">color.good</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=purple</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">color.bad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=yellow</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">allow.textmode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">how.nice.to.look</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=fairlyNice</span></span></code></pre></div><p>使用 <code>--from-env-file</code> 选项基于 env 文件创建 ConfigMap，例如：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Env 文件包含环境变量列表。其中适用以下语法规则:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些语法规则适用：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   Env 文件中的每一行必须为 VAR=VAL 格式。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   以＃开头的行（即注释）将被忽略。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   空行将被忽略。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   引号不会被特殊处理（即它们将成为 ConfigMap 值的一部分）。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将示例文件下载到 \`configure-pod-container/configmap/\` 目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://kubernetes.io/examples/configmap/game-env-file.properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    configure-pod-container/configmap/game-env-file.properties</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://kubernetes.io/examples/configmap/ui-env-file.properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    configure-pod-container/configmap/ui-env-file.properties</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Env 文件 \`game-env-file.properties\` 如下所示</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure-pod-container/configmap/game-env-file.properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enemies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aliens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allowed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This comment and the empty line above it are ignored</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>kubectl create configmap game-config-env-file \\</span></span>
<span class="line"><span>       --from-env-file=configure-pod-container/configmap/game-env-file.properties</span></span></code></pre></div><p>将产生以下 ConfigMap。查看 ConfigMap：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-env-file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span></span></code></pre></div><p>输出类似以下内容：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  creationTimestamp:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2019</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-12-27T18:36:28Z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> game-config-env-file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resourceVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;809965&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  uid:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d9d1ca5b-eb34-11e7-887b-42010a8002b8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  allowed:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&quot;true&quot;&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  enemies:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aliens</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  lives:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;3&quot;</span></span></code></pre></div><h2 id="local" tabindex="-1">local <a class="header-anchor" href="#local" aria-label="Permalink to &quot;local&quot;">​</a></h2><h2 id="nfs" tabindex="-1">nfs <a class="header-anchor" href="#nfs" aria-label="Permalink to &quot;nfs&quot;">​</a></h2><p><a href="/linux/nfs.html">NFS安装</a></p><h2 id="persistentvolume" tabindex="-1">PersistentVolume <a class="header-anchor" href="#persistentvolume" aria-label="Permalink to &quot;PersistentVolume&quot;">​</a></h2><p>持久卷（PersistentVolume，PV） 是集群中的一块存储，可以由管理员事先制备， 或者使用存储类（Storage Class）来动态制备。 持久卷是集群资源，就像节点也是集群资源一样。PV 持久卷和普通的 Volume 一样， 也是使用卷插件来实现的，只是它们拥有独立于任何使用 PV 的 Pod 的生命周期。 此 API 对象中记述了存储的实现细节，无论其背后是 NFS、iSCSI 还是特定于云平台的存储系统。</p><h3 id="持久卷的类型" tabindex="-1">持久卷的类型 <a class="header-anchor" href="#持久卷的类型" aria-label="Permalink to &quot;持久卷的类型&quot;">​</a></h3><p>PV 持久卷是用插件的形式来实现的。Kubernetes 目前支持以下插件：</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><a href="#local">local</a></td><td>节点上挂载的本地存储设备</td></tr><tr><td><a href="#nfs">nfs</a></td><td>网络文件系统 (NFS) 存储</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#hostpath" target="_blank" rel="noreferrer">hostPath</a></td><td>HostPath 卷 （仅供单节点测试使用；不适用于多节点集群；请尝试使用 local 卷作为替代）</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#cephfs" target="_blank" rel="noreferrer">cephfs</a></td><td>CephFS volume</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#csi" target="_blank" rel="noreferrer">csi</a></td><td>容器存储接口 (CSI)</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#fc" target="_blank" rel="noreferrer">fc</a></td><td>Fibre Channel (FC) 存储</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#iscsi" target="_blank" rel="noreferrer">iscsi</a></td><td>iSCSI (SCSI over IP) 存储</td></tr><tr><td><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#rbd" target="_blank" rel="noreferrer">rbd </a></td><td>Rados 块设备 (RBD) 卷</td></tr></tbody></table><h3 id="持久卷" tabindex="-1">持久卷 <a class="header-anchor" href="#持久卷" aria-label="Permalink to &quot;持久卷&quot;">​</a></h3><p>每个 PV 对象都包含 spec 部分和 status 部分，分别对应卷的规约和状态。 PersistentVolume 对象的名称必须是合法的 DNS 子域名.</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PersistentVolume</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pv0003</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  capacity:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    storage:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Gi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  volumeMode:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Filesystem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  accessModes:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ReadWriteOnce</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  persistentVolumeReclaimPolicy:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Recycle</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  storageClassName:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> slow</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  mountOptions:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hard</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nfsvers=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  nfs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    path:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    server:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0.2</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>在集群中使用持久卷存储通常需要一些特定于具体卷类型的辅助程序。 在这个例子中，PersistentVolume 是 NFS 类型的，因此需要辅助程序 /sbin/mount.nfs 来支持挂载 NFS 文件系统。</p></div><h4 id="容量" tabindex="-1">容量 <a class="header-anchor" href="#容量" aria-label="Permalink to &quot;容量&quot;">​</a></h4><p>一般而言，每个 PV 卷都有确定的存储容量。 容量属性是使用 PV 对象的 capacity 属性来设置的。 参考词汇表中的<a href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-quantity" target="_blank" rel="noreferrer">量纲（Quantity）</a> 词条，了解 capacity 字段可以接受的单位。</p><p>目前，存储大小是可以设置和请求的唯一资源。 未来可能会包含 IOPS、吞吐量等属性。</p><table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>storage</td><td>PV 卷的存储容量。</td><td>spec.capacity.storage: 5Gi</td></tr></tbody></table><h4 id="卷模式" tabindex="-1">卷模式 <a class="header-anchor" href="#卷模式" aria-label="Permalink to &quot;卷模式&quot;">​</a></h4><p>针对 PV 持久卷，<a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode" target="_blank" rel="noreferrer"><code>volumeModes</code></a> 两种卷模式：<code>Filesystem（文件系统）</code> 和 <code>Block（块）</code>。</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>Filesystem（默认类型）</td><td>卷会被 Pod 挂载（Mount） 到某个目录。</td></tr><tr><td>Block</td><td>将卷作为原始块设备来使用。</td></tr></tbody></table><h4 id="访问模式" tabindex="-1">访问模式 <a class="header-anchor" href="#访问模式" aria-label="Permalink to &quot;访问模式&quot;">​</a></h4><p>PersistentVolume 卷可以用资源提供者所支持的任何方式挂载到宿主系统上。</p><p>访问模式有：</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>ReadWriteOnce</td><td>卷可以被一个节点以读写方式挂载。 ReadWriteOnce 访问模式也允许运行在同一节点上的多个 Pod 访问卷。</td></tr><tr><td>ReadOnlyMany</td><td>卷可以被多个节点以只读方式挂载。</td></tr><tr><td>ReadWriteMany</td><td>卷可以被多个节点以读写方式挂载。</td></tr><tr><td>ReadWriteOncePod</td><td>卷可以被单个 Pod 以读写方式挂载。</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>重要提醒！ 每个卷同一时刻只能以一种访问模式挂载，即使该卷能够支持多种访问模式。 例如，一个 GCEPersistentDisk 卷可以被某节点以 ReadWriteOnce 模式挂载，或者被多个节点以 ReadOnlyMany 模式挂载，但不可以同时以两种模式挂载。</p></div><table><thead><tr><th>卷插件</th><th>ReadWriteOnce</th><th>ReadOnlyMany</th><th>ReadWriteMany</th><th>ReadWriteOncePod</th></tr></thead><tbody><tr><td>NFS</td><td>✓</td><td>✓</td><td>✓</td><td>-</td></tr><tr><td>HostPath</td><td>✓</td><td>-</td><td>-</td><td>-</td></tr><tr><td>CephFS</td><td>✓</td><td>✓</td><td>✓</td><td>-</td></tr><tr><td>CSI</td><td>取决于驱动</td><td>取决于驱动</td><td>取决于驱动</td><td>取决于驱动</td></tr><tr><td>FC</td><td>✓</td><td>✓</td><td>-</td><td>-</td></tr><tr><td>Glusterfs</td><td>✓</td><td>✓</td><td>✓</td><td>-</td></tr><tr><td>iSCSI</td><td>✓</td><td>✓</td><td>-</td><td>-</td></tr><tr><td>RBD</td><td>✓</td><td>✓</td><td>-</td><td>-</td></tr></tbody></table><h4 id="类" tabindex="-1">类 <a class="header-anchor" href="#类" aria-label="Permalink to &quot;类&quot;">​</a></h4><p>每个 PV 可以属于某个类（Class），通过将其 <code>storageClassName</code> 属性设置为某个 <a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#class" target="_blank" rel="noreferrer">StorageClass</a> 的名称来指定。 特定类的 PV 卷只能绑定到请求该类存储卷的 PVC 申领。 未设置 storageClassName 的 PV 卷没有类设定，只能绑定到那些没有指定特定存储类的 PVC 申领。</p><h4 id="回收策略" tabindex="-1">回收策略 <a class="header-anchor" href="#回收策略" aria-label="Permalink to &quot;回收策略&quot;">​</a></h4><p>目前的回收策略有：</p><table><thead><tr><th>策略</th><th>描述</th></tr></thead><tbody><tr><td>Retain</td><td>手动回收</td></tr><tr><td>Recycle</td><td>基本擦除 (<code>rm -rf /thevolume/*</code>)</td></tr><tr><td>Delete</td><td>诸如 AWS EBS、GCE PD、Azure Disk 或 OpenStack Cinder 卷这类关联存储资产也被删除</td></tr></tbody></table><p>目前，仅 NFS 和 HostPath 支持回收（Recycle）。 AWS EBS、GCE PD、Azure Disk 和 Cinder 卷都支持删除（Delete）。</p><h4 id="挂载选项" tabindex="-1">挂载选项 <a class="header-anchor" href="#挂载选项" aria-label="Permalink to &quot;挂载选项&quot;">​</a></h4><p>Kubernetes 管理员可以指定持久卷被挂载到节点上时使用的附加挂载选项。</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>并非所有持久卷类型都支持挂载选项。</p></div><p>以下卷类型支持挂载选项：</p><ul><li>cephfs</li><li>iscsi</li><li>nfs</li><li>rbd</li></ul><p>Kubernetes 不对挂载选项执行合法性检查。如果挂载选项是非法的，挂载就会失败</p><h4 id="节点亲和性" tabindex="-1">节点亲和性 <a class="header-anchor" href="#节点亲和性" aria-label="Permalink to &quot;节点亲和性&quot;">​</a></h4><div class="info custom-block"><p class="custom-block-title">INFO</p><p>对大多数类型的卷而言，你不需要设置节点亲和性字段。 AWS EBS、 GCE PD 和 Azure Disk 卷类型都能自动设置相关字段。 你需要为 <a href="#local">local</a> 卷显式地设置此属性。</p></div><p>每个 PV 卷可以通过设置节点亲和性来定义一些约束，进而限制从哪些节点上可以访问此卷。 使用这些卷的 Pod 只会被调度到节点亲和性规则所选择的节点上执行。 要设置节点亲和性，配置 PV 卷 <code>.spec</code> 中的 <code>nodeAffinity</code>。 持久卷 API 参考关于该字段的更多细节。</p><h4 id="阶段" tabindex="-1">阶段 <a class="header-anchor" href="#阶段" aria-label="Permalink to &quot;阶段&quot;">​</a></h4><p>每个卷会处于以下阶段（Phase）之一：</p><table><thead><tr><th>阶段</th><th>描述</th></tr></thead><tbody><tr><td>Available（可用）</td><td>卷是一个空闲资源，尚未绑定到任何申领；</td></tr><tr><td>Bound（已绑定</td><td>该卷已经绑定到某申领；</td></tr><tr><td>Released（已释放）</td><td>所绑定的申领已被删除，但是资源尚未被集群回收；</td></tr><tr><td>Failed（失败）</td><td>卷的自动回收操作失败。</td></tr></tbody></table><p>命令行接口能够显示绑定到某 PV 卷的 PVC 对象。</p><h2 id="persistentvolumeclaim" tabindex="-1">persistentVolumeClaim <a class="header-anchor" href="#persistentvolumeclaim" aria-label="Permalink to &quot;persistentVolumeClaim&quot;">​</a></h2><p>持久卷申领（PersistentVolumeClaim，PVC）表达的是用户对存储的请求。概念上与 Pod 类似。 Pod 会耗用节点资源，而 PVC 申领会耗用 PV 资源。Pod 可以请求特定数量的资源（CPU 和内存）；同样 PVC 申领也可以请求特定的大小和访问模式 （例如，可以要求 PV 卷能够以 ReadWriteOnce、ReadOnlyMany 或 ReadWriteMany 模式之一来挂载，参见访问模式）。</p><p>每个 PVC 对象都有 spec 和 status 部分，分别对应申领的规约和状态。 PersistentVolumeClaim 对象的名称必须是合法的 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/names#dns-subdomain-names" target="_blank" rel="noreferrer">DNS 子域名</a>.</p><h2 id="secret" tabindex="-1">secret <a class="header-anchor" href="#secret" aria-label="Permalink to &quot;secret&quot;">​</a></h2>`,88),l=[e];function p(h,k,d,r,o,c){return i(),a("div",null,l)}const y=s(t,[["render",p]]);export{F as __pageData,y as default};
